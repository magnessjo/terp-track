(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const E="terp-track-session",j=1440*60*1e3;function q(e,t){if(!e)return null;try{const n=JSON.parse(e);return t>=n.expiresAt?null:n}catch{return null}}function U(e,t){return{username:e,expiresAt:t+j}}function W(e,t){return e==="demo"&&t==="demo"}function z(){const e=localStorage.getItem(E),t=q(e,Date.now());return t||(B(),null)}function $(e){const t=U(e,Date.now());localStorage.setItem(E,JSON.stringify(t))}function B(){localStorage.removeItem(E)}function G(e){const t=e.username.trim();return W(t,e.password)?{success:!0,username:t,shouldPersist:e.remember}:{success:!1}}const V='<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>',Y='<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z" fill="#fff"/></svg>';function J(e){const t=document.querySelector("terp-login");if(!t)return;t.setAttribute("data-tab","password");const n=document.createElement("div");n.className="login-card";const o=document.createElement("h1");o.className="login-heading",o.textContent="Welcome back";const a=document.createElement("p");a.className="login-subtitle",a.textContent="Sign in to continue to Terp Track";const s=K(),i=X(),r=Q(t),l=Z(e),u=ee(),m=te();n.appendChild(o),n.appendChild(a),n.appendChild(s),n.appendChild(i),n.appendChild(r),n.appendChild(l),n.appendChild(u),n.appendChild(m),t.appendChild(n)}function K(){const e=document.createElement("div");e.className="login-social";const t=document.createElement("button");t.type="button",t.className="login-social-btn",t.innerHTML=`${V} Google`;const n=document.createElement("button");return n.type="button",n.className="login-social-btn",n.innerHTML=`${Y} Apple`,e.appendChild(t),e.appendChild(n),e}function X(){const e=document.createElement("div");return e.className="login-divider",e.textContent="or continue with email",e}function Q(e){const t=document.createElement("div");t.className="login-tabs";const n=document.createElement("button");n.type="button",n.className="login-tab",n.setAttribute("data-tab-target","password"),n.textContent="Password";const o=document.createElement("button");return o.type="button",o.className="login-tab",o.setAttribute("data-tab-target","magic-link"),o.textContent="Magic Link",t.addEventListener("click",a=>{const s=a.target.closest("[data-tab-target]");if(!s)return;const i=s.getAttribute("data-tab-target");i&&e.setAttribute("data-tab",i)}),t.appendChild(n),t.appendChild(o),t}function Z(e){const t=document.createElement("div");t.className="login-panel",t.setAttribute("data-panel","password");const n=document.createElement("label");n.textContent="Username";const o=document.createElement("input");o.type="text",o.placeholder="Enter your username",o.autocomplete="username",n.setAttribute("for","login-username"),o.id="login-username";const a=document.createElement("label");a.textContent="Password";const s=document.createElement("input");s.type="password",s.placeholder="Enter your password",s.autocomplete="current-password",a.setAttribute("for","login-password"),s.id="login-password";const i=document.createElement("label");i.className="login-remember";const r=document.createElement("input");r.type="checkbox",r.checked=!0,i.appendChild(r),i.appendChild(document.createTextNode("Remember me for 24 hours"));const l=document.createElement("p");l.className="login-error",l.setAttribute("role","alert"),l.textContent="Invalid username or password";const u=document.createElement("button");u.type="button",u.className="login-submit",u.textContent="Sign in";const m=()=>{const c=G({username:o.value,password:s.value,remember:r.checked});c.success?(l.setAttribute("data-visible","false"),c.shouldPersist&&$(c.username),e()):l.setAttribute("data-visible","true")};return u.addEventListener("click",m),o.addEventListener("keydown",c=>{c.key==="Enter"&&m()}),s.addEventListener("keydown",c=>{c.key==="Enter"&&m()}),t.appendChild(n),t.appendChild(o),t.appendChild(a),t.appendChild(s),t.appendChild(i),t.appendChild(l),t.appendChild(u),t}function ee(){const e=document.createElement("div");e.className="login-panel",e.setAttribute("data-panel","magic-link");const t=document.createElement("label");t.textContent="Email address";const n=document.createElement("input");n.type="email",n.placeholder="you@example.com",n.autocomplete="email",t.setAttribute("for","login-email"),n.id="login-email";const o=document.createElement("button");return o.type="button",o.className="login-submit",o.textContent="Send magic link",e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function te(){const e=document.createElement("p");return e.className="login-footer",e.innerHTML=`Don't have an account? <a href="#">Create one</a>`,e}const O=new Set(["image/png","image/jpeg","image/gif","image/webp","application/pdf","text/plain","text/csv"]),ne=new Set([".png",".jpg",".jpeg",".gif",".webp",".pdf",".txt",".csv"]),ae=[...O].join(","),oe=10*1024*1024;function H(e){const t=e.lastIndexOf(".");return t===-1?"":e.slice(t).toLowerCase()}function se(e,t){return O.has(e)?!0:ne.has(H(t))}function re(e,t,n){return se(n,e)?t>oe?{valid:!1,reason:"File exceeds 10 MB limit."}:{valid:!0}:{valid:!1,reason:"File type not supported."}}function ie(e,t){if(e.length<=t)return e;const n=H(e);return e.slice(0,e.length-n.length).slice(0,t-n.length-1)+"…"+n}function le(e){return e.startsWith("image/")}function ce(e){const t=e.trim();return t?t.toLowerCase()==="demo mode"?{kind:"command",command:"demo-mode"}:{kind:"message",text:t}:{kind:"empty"}}function de(e){return e==="demo"?"default":"demo"}function ue(e){return{request:e}}const me="What deliverables are due today and this week?";function pe(e){const t={sender:"bot",type:e.type,text:e.message};return e.data!=null&&typeof e.data=="object"&&"items"in e.data&&Array.isArray(e.data.items)&&(t.items=e.data.items),t}function he(){return{sender:"bot",type:"error",text:"Unable to reach the server. Please refresh to try again."}}function L(){return{sender:"bot",type:"error",text:"Something went wrong on our end. Please contact admin for assistance."}}function ge(){return{sender:"bot",type:"info",text:"Welcome to Terp Track! Tell me what you need help with — I can create, update, or check on your Trello tasks."}}function fe(e){const t={"data-sender":e.sender};return e.type&&(t["data-type"]=e.type),t}function be(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ve(e){if(!e)return"";let t=be(e);t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>");const n=t.split(/\\n|\n/),o=[];let a=[];const s=()=>{if(a.length>0){const r=a.map(l=>`<li>${l}</li>`).join("");o.push(`<ul>${r}</ul>`),a=[]}};for(const r of n){const l=r.trim(),u=l.match(/^[•\-]\s*(.*)/);u?a.push(u[1]):(s(),o.push(l))}s();let i=o.filter(r=>r.length>0).join("<br>");return i=i.replace(/https?:\/\/[^\s<)]+/g,r=>`<a href="${r}" target="_blank" rel="noopener noreferrer">${r}</a>`),i}const Ce="/assets/logo-light-u-T4B736.png",Ee="/assets/logo-dark-BA7I73qX.png",ye="/assets/pattern-DYRakOeC.png",D="/assets/chat-icon-BEYFjzHp.png",A=document.getElementById("shell-pattern");A&&(A.style.backgroundImage=`url('${ye}')`);const S="https://n8n.srv975877.hstgr.cloud/webhook/school-trello",T=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
  <circle cx="12" cy="12" r="3"/>
  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
</svg>`,_=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
  <line x1="18" y1="6" x2="6" y2="18"/>
  <line x1="6" y1="6" x2="18" y2="18"/>
</svg>`,F=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
</svg>`,we=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor" aria-hidden="true">
  <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
</svg>`;function y(){return localStorage.getItem("terp-track-theme")==="dark"?"dark":"light"}function R(e){return e==="dark"?Ee:Ce}function C(e,t){localStorage.setItem("terp-track-theme",t),e.setAttribute("data-theme",t);const n=e.querySelector(".chat-header img");n&&(n.src=R(t))}function xe(){const e=document.querySelector("terp-chat");if(!e)return;C(e,y());const t=ke(e),n=Le(),o=Ae(),a=Se(),s=Ne(e);n.appendChild(o);const i=document.createElement("div");i.className="chat-content",i.appendChild(n),i.appendChild(a);const r=document.createElement("div");r.className="chat-body",r.appendChild(i),r.appendChild(s),e.appendChild(t),e.appendChild(r);const l=a.querySelector('input[type="text"]'),u=a.querySelector(".send-btn"),m=a.querySelector(".upload-btn"),c=a.querySelector('input[type="file"]'),g=a.querySelector(".file-preview-area");let v=null;function w(d){const p=re(d.name,d.size,d.type);if(!p.valid){h(n,o,{sender:"bot",type:"error",text:p.reason});return}v=d,Te(g,d,x)}function x(){v=null,g.hidden=!0,g.innerHTML="",c.value=""}m.addEventListener("click",()=>c.click()),c.addEventListener("change",()=>{var d;(d=c.files)!=null&&d[0]&&w(c.files[0])});let b=0;a.addEventListener("dragenter",d=>{d.preventDefault(),b++,a.setAttribute("data-drag-over","true")}),a.addEventListener("dragleave",()=>{b--,b===0&&a.removeAttribute("data-drag-over")}),a.addEventListener("dragover",d=>d.preventDefault()),a.addEventListener("drop",d=>{var f;d.preventDefault(),b=0,a.removeAttribute("data-drag-over");const p=(f=d.dataTransfer)==null?void 0:f.files[0];p&&w(p)}),h(n,o,ge()),P(e,n,o,me);const k=()=>{const d=ce(l.value),p=v;if(d.kind==="empty"&&!p)return;if(l.value="",p&&x(),d.kind==="command"){e.setAttribute("data-mode",de(e.getAttribute("data-mode")));return}const f=d.kind==="message"?d.text:"",N={sender:"user",text:f};p&&(N.attachment={name:p.name,type:p.type}),h(n,o,N),P(e,n,o,f,p)};u.addEventListener("click",k),l.addEventListener("keydown",d=>{d.key==="Enter"&&k()})}function ke(e){const t=document.createElement("div");t.className="chat-header";const n=document.createElement("img");n.src=R(y()),n.alt="Terp Track logo",n.width=36,n.height=36;const o=document.createElement("h1");o.textContent="Terp Track";const a=document.createElement("button");return a.type="button",a.className="settings-toggle",a.setAttribute("aria-label","Settings"),a.innerHTML=T,a.addEventListener("click",()=>{const s=e.getAttribute("data-settings")==="open";e.setAttribute("data-settings",s?"closed":"open"),a.innerHTML=s?T:_,a.setAttribute("aria-label",s?"Settings":"Close settings")}),t.appendChild(n),t.appendChild(o),t.appendChild(a),t}function Ne(e){const t=document.createElement("div");t.className="settings-panel";const n=document.createElement("div");n.className="settings-row";const o=document.createElement("span");o.className="settings-label",o.textContent="Theme";const a=document.createElement("div");a.className="settings-btn-group";const s=document.createElement("button");s.type="button",s.textContent="Light",s.setAttribute("data-theme-option","light");const i=document.createElement("button");i.type="button",i.textContent="Dark",i.setAttribute("data-theme-option","dark");const r=()=>{const g=y();s.classList.toggle("active",g==="light"),i.classList.toggle("active",g==="dark")};r(),s.addEventListener("click",()=>{C(e,"light"),r()}),i.addEventListener("click",()=>{C(e,"dark"),r()}),a.appendChild(s),a.appendChild(i),n.appendChild(o),n.appendChild(a);const l=document.createElement("div");l.className="settings-row";const u=document.createElement("span");u.className="settings-label",u.textContent="Privacy";const m=document.createElement("span");m.className="settings-placeholder",m.textContent="Coming soon",l.appendChild(u),l.appendChild(m);const c=document.createElement("button");return c.type="button",c.className="settings-logout",c.textContent="Logout",c.addEventListener("click",()=>{B(),location.reload()}),t.appendChild(n),t.appendChild(l),t.appendChild(c),t}function Le(){const e=document.createElement("div");return e.className="chat-messages",e.setAttribute("role","log"),e.setAttribute("aria-live","polite"),e}function Ae(){const e=document.createElement("div");e.className="chat-loading",e.setAttribute("aria-label","Loading");const t=document.createElement("img");t.className="message-avatar",t.src=D,t.alt="",e.appendChild(t);const n=document.createElement("div");n.className="chat-loading-dots";for(let o=0;o<3;o++){const a=document.createElement("span");a.className="chat-loading-dot",n.appendChild(a)}return e.appendChild(n),e}function Se(){const e=document.createElement("div");e.className="chat-input-area";const t=document.createElement("div");t.className="file-preview-area",t.hidden=!0;const n=document.createElement("div");n.className="chat-input-row";const o=document.createElement("button");o.type="button",o.className="upload-btn",o.setAttribute("aria-label","Attach file"),o.innerHTML=F;const a=document.createElement("input");a.type="file",a.className="file-input-hidden",a.accept=ae,a.setAttribute("aria-hidden","true"),a.tabIndex=-1;const s=document.createElement("input");s.type="text",s.placeholder="Type a message…",s.setAttribute("aria-label","Message input");const i=document.createElement("button");return i.type="button",i.className="send-btn",i.textContent="Send",n.appendChild(o),n.appendChild(a),n.appendChild(s),n.appendChild(i),e.appendChild(t),e.appendChild(n),e}function Te(e,t,n){var i;e.innerHTML="",e.hidden=!1;const o=document.createElement("div");if(o.className="file-chip",le(t.type)){const r=document.createElement("img");r.className="file-chip-thumb",r.alt=t.name;const l=URL.createObjectURL(t);r.src=l,r.onload=()=>URL.revokeObjectURL(l),o.appendChild(r)}else{const r=document.createElement("span");r.className="file-chip-icon";const l=((i=t.name.split(".").pop())==null?void 0:i.toUpperCase())??"";r.textContent=l,o.appendChild(r)}const a=document.createElement("span");a.className="file-chip-name",a.textContent=ie(t.name,24);const s=document.createElement("button");s.type="button",s.className="file-chip-remove",s.setAttribute("aria-label","Remove file"),s.innerHTML=_,s.addEventListener("click",n),o.appendChild(a),o.appendChild(s),e.appendChild(o)}function h(e,t,n){const o=document.createElement("div");o.className="chat-message";const a=fe(n);for(const[r,l]of Object.entries(a))o.setAttribute(r,l);if(n.sender==="bot"){const r=document.createElement("img");r.className="message-avatar",r.src=D,r.alt="",o.appendChild(r)}const s=document.createElement("div");s.className="message-bubble";const i=document.createElement("span");if(n.sender==="bot"?i.innerHTML=ve(n.text):i.textContent=n.text,s.appendChild(i),n.items&&n.items.length>0){const r=document.createElement("ul");r.className="message-item-list";for(const l of n.items){const u=document.createElement("li");u.className="message-item";const m=document.createElement("span");m.className="message-item-name",m.textContent=l.name;const c=document.createElement("span");c.className="message-item-details",c.textContent=`${l.course} · Due ${l.dueDate} · ${l.status}`,u.appendChild(m),u.appendChild(c),r.appendChild(u)}s.appendChild(r)}if(n.attachment){const r=document.createElement("div");r.className="message-attachment",r.innerHTML=F;const l=document.createElement("span");l.textContent=n.attachment.name,r.appendChild(l),s.appendChild(r)}if(o.appendChild(s),n.sender==="user"){const r=document.createElement("div");r.className="message-avatar",r.innerHTML=we,o.appendChild(r)}e.insertBefore(o,t),e.scrollTop=e.scrollHeight}function M(e,t){e.setAttribute("data-loading",String(t));const n=e.querySelector(".send-btn");if(n)if(t){n.disabled=!0,n.dataset.originalText=n.textContent??"",n.textContent="";const o=document.createElement("span");o.className="send-spinner",n.appendChild(o)}else n.disabled=!1,n.textContent=n.dataset.originalText??"Send",delete n.dataset.originalText}async function P(e,t,n,o,a=null){M(e,!0);try{let s;if(a){const r=new FormData;r.append("request",o),r.append("file",a,a.name),s=await fetch(S,{method:"POST",body:r})}else s=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ue(o))});if(!s.ok){console.error("Webhook returned status:",s.status),h(t,n,L());return}const i=await s.json();h(t,n,pe(i))}catch(s){console.error("Webhook request failed:",s),s instanceof TypeError?h(t,n,he()):h(t,n,L())}finally{M(e,!1);const s=e.querySelector('.chat-input-area input[type="text"]');s==null||s.focus()}}function I(){const e=()=>{document.body.setAttribute("data-page","chat"),xe()};document.startViewTransition?document.startViewTransition(e):e()}function Me(){z()?I():J(I)}document.addEventListener("DOMContentLoaded",Me);
